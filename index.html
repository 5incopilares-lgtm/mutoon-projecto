<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªÙˆÙ† Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù… - Ø§Ø®ØªØ¨Ø§Ø± ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .lang-switcher {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .lang-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border: none;
            background: none;
            font-size: 1em;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .quiz-section {
            margin-bottom: 30px;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .quiz-btn {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .quiz-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .question-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-right: 5px solid #667eea;
        }
        
        .question-text {
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-btn {
            padding: 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            text-align: right;
        }
        
        .option-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }
        
        .option-btn.correct {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .option-btn.wrong {
            background: #f8d7da;
            border-color: #dc3545;
        }
        
        .score-display {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }
        
        .leaderboard {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin: 10px 0;
            border-right: 4px solid #667eea;
        }
        
        .rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
        }
        
        .name {
            flex: 1;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
        }
        
        .user-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            direction: rtl;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .book-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .book-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .level-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .book-title {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            color: #333;
        }
        
        .book-author {
            color: #666;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #ffc107;
            color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .chapter-list {
            list-style: none;
            padding: 0;
        }
        
        .chapter-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 8px 0;
            border-right: 3px solid #667eea;
        }
        
        .key-point {
            padding: 10px;
            background: #e7f3ff;
            border-radius: 6px;
            margin: 5px 0;
            font-size: 0.95em;
        }
        
        .must-know-section {
            background: #fff9e6;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .must-know-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #f57c00;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .must-know-item {
            padding: 12px;
            background: white;
            border-right: 4px solid #ffc107;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 1.05em;
        }
        
        .study-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            transition: all 0.3s;
        }
        
        .study-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .test-this-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 15px;
            transition: transform 0.2s;
        }
        
        .test-this-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="lang-switcher">
                <button class="lang-btn active" onclick="changeLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                <button class="lang-btn" onclick="changeLanguage('en')">English</button>
                <button class="lang-btn" onclick="changeLanguage('es')">EspaÃ±ol</button>
            </div>
            <h1 id="mainTitle">ğŸ“š Ù…ØªÙˆÙ† Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…</h1>
            <p id="subtitle">Ø¬Ù…Ø¹ ÙˆØªØ±ØªÙŠØ¨ ÙˆØªØ­Ù‚ÙŠÙ‚: Ø¯. Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø§Ø³Ù…</p>
            <p id="description" style="font-size: 0.9em; margin-top: 10px;">Ø§Ø®ØªØ¨Ø§Ø± ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¥Ø®ÙˆØ© Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¹Ù„Ù…</p>
        </header>
        
        <div class="tabs">
            <button class="tab" onclick="showTab('study')"><span class="tab-text">Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</span></button>
            <button class="tab active" onclick="showTab('quiz')"><span class="tab-text">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span></button>
            <button class="tab" onclick="showTab('library')"><span class="tab-text">Ø§Ù„Ù…ÙƒØªØ¨Ø©</span></button>
            <button class="tab" onclick="showTab('progress')"><span class="tab-text">Ø§Ù„ØªÙ‚Ø¯Ù…</span></button>
            <button class="tab" onclick="showTab('leaderboard')"><span class="tab-text">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</span></button>
        </div>
        
        <div class="content">
            <!-- Study Tab -->
            <div id="study" class="tab-content">
                <h2 id="studyTitle">ğŸ“– ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h2>
                <p id="studyDescription" style="color: #666; margin-bottom: 20px;">Ø§Ø¯Ø±Ø³ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ÙƒÙ„ ÙƒØªØ§Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                <div id="studyContent"></div>
            </div>
            
            <!-- Quiz Tab -->
            <div id="quiz" class="tab-content active">
                <div id="userSetup" class="user-form">
                    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù…Ù† Ø£Ù†ØªØŸ</h2>
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø£Ø¶Ù Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:</label>
                        <select id="userSelect" onchange="handleUserSelect()">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="new">Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯</option>
                        </select>
                    </div>
                    <div class="form-group" id="newUserInput" style="display:none;">
                        <label>Ø§Ø³Ù…Ùƒ:</label>
                        <input type="text" id="newUserName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
                    </div>
                    <button class="btn-primary" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                </div>
                
                <div id="quizInterface" style="display:none;">
                    <div class="score-display">
                        <span id="currentUserName"></span> | Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="currentScore">0</span>
                    </div>
                    
                    <div class="quiz-section">
                        <h2>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h2>
                        <div class="quiz-options">
                            <button class="quiz-btn" onclick="startQuizMode('bookId')">ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ§Ø¨</button>
                            <button class="quiz-btn" onclick="startQuizMode('authorId')">ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ù„Ù</button>
                            <button class="quiz-btn" onclick="startQuizMode('levelMatch')">Ø·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
                            <button class="quiz-btn" onclick="startQuizMode('chapterRecall')">ØªØ°ÙƒØ± Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨</button>
                            <button class="quiz-btn" onclick="startQuizMode('keyPoints')">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                            <button class="quiz-btn" onclick="startQuizMode('random')">Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</button>
                        </div>
                    </div>
                    
                    <div id="questionArea"></div>
                    
                    <button class="btn-secondary" onclick="endQuiz()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                </div>
            </div>
            
            <!-- Library Tab -->
            <div id="library" class="tab-content">
                <h2>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…ØªÙˆÙ†</h2>
                <div id="libraryGrid" class="library-grid"></div>
            </div>
            
            <!-- Progress Tab -->
            <div id="progress" class="tab-content">
                <h2>ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h2>
                <div id="progressContent"></div>
            </div>
            
            <!-- Leaderboard Tab -->
            <div id="leaderboard" class="tab-content">
                <h2>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
                <div class="leaderboard" id="leaderboardContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Book Details Modal -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <div id="bookDetails"></div>
            <button class="btn-primary" onclick="closeModal()" style="margin-top: 20px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // Language Translations
        const translations = {
            ar: {
                mainTitle: "ğŸ“š Ù…ØªÙˆÙ† Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…",
                subtitle: "Ø¬Ù…Ø¹ ÙˆØªØ±ØªÙŠØ¨ ÙˆØªØ­Ù‚ÙŠÙ‚: Ø¯. Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø§Ø³Ù…",
                description: "Ø§Ø®ØªØ¨Ø§Ø± ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¥Ø®ÙˆØ© Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¹Ù„Ù…",
                tabQuiz: "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
                tabLibrary: "Ø§Ù„Ù…ÙƒØªØ¨Ø©",
                tabProgress: "Ø§Ù„ØªÙ‚Ø¯Ù…",
                tabLeaderboard: "Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†",
                welcomeTitle: "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù…Ù† Ø£Ù†ØªØŸ",
                selectName: "Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø£Ø¶Ù Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:",
                chooseOption: "-- Ø§Ø®ØªØ± --",
                addNew: "Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯",
                yourName: "Ø§Ø³Ù…Ùƒ:",
                enterName: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ",
                startQuiz: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
                points: "Ø§Ù„Ù†Ù‚Ø§Ø·",
                chooseQuizType: "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:",
                bookId: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ§Ø¨",
                authorId: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ù„Ù",
                levelMatch: "Ø·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø³ØªÙˆÙ‰",
                chapterRecall: "ØªØ°ÙƒØ± Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨",
                keyPoints: "Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                random: "Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„",
                endQuiz: "Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
                libraryTitle: "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…ØªÙˆÙ†",
                progressTitle: "ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",
                leaderboardTitle: "ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†",
                close: "Ø¥ØºÙ„Ø§Ù‚",
                author: "Ø§Ù„Ù…Ø¤Ù„Ù",
                topic: "Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹",
                chaptersTitle: "Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:",
                note: "Ù…Ù„Ø§Ø­Ø¸Ø©:",
                noteText: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø£Ø¨ÙˆØ§Ø¨ ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø´Ø±Ø­ Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ù‚Ø§Ø³Ù…",
                excellent: "Ø£Ø­Ø³Ù†Øª!",
                score: "Ø§Ù„Ù†ØªÙŠØ¬Ø©:",
                totalScore: "Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø·Ùƒ:",
                newQuiz: "Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯",
                quizCount: "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:",
                level1: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„",
                level2: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ",
                level3: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«",
                level4: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹",
                level5: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³",
                completed: "Ø£ØªÙ…Ù…Øª",
                of: "Ù…Ù†",
                booksText: "ÙƒØªØ§Ø¨Ø§Ù‹",
                totalPointsLabel: "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·",
                quizCountLabel: "Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª",
                streakLabel: "Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©",
                question: "Ø³Ø¤Ø§Ù„"
            },
            en: {
                mainTitle: "ğŸ“š Student of Knowledge Texts",
                subtitle: "Compiled and Verified by: Dr. Abdul Muhsin Al-Qasim",
                description: "Quiz and Progress Tracker for Students of Knowledge",
                tabQuiz: "Quiz",
                tabLibrary: "Library",
                tabProgress: "Progress",
                tabLeaderboard: "Leaderboard",
                welcomeTitle: "Welcome! Who are you?",
                selectName: "Select your name or add new:",
                chooseOption: "-- Choose --",
                addNew: "Add new name",
                yourName: "Your name:",
                enterName: "Enter your name",
                startQuiz: "Start Quiz",
                points: "Points",
                chooseQuizType: "Choose Quiz Type:",
                bookId: "Identify the Book",
                authorId: "Identify the Author",
                levelMatch: "Match the Level",
                chapterRecall: "Recall Chapters",
                keyPoints: "Key Points",
                random: "Random Quiz",
                endQuiz: "End Quiz",
                libraryTitle: "Texts Library",
                progressTitle: "Your Study Progress",
                leaderboardTitle: "ğŸ† Leaderboard",
                close: "Close",
                author: "Author",
                topic: "Topic",
                chaptersTitle: "Chapters and Key Points:",
                note: "Note:",
                noteText: "You can add more details, chapters, and key points from Sheikh Abdul Muhsin Al-Qasim's explanations",
                excellent: "Excellent!",
                score: "Score:",
                totalScore: "Total Score:",
                newQuiz: "New Quiz",
                quizCount: "Quizzes:",
                level1: "Level 1",
                level2: "Level 2",
                level3: "Level 3",
                level4: "Level 4",
                level5: "Level 5",
                completed: "Completed",
                of: "of",
                booksText: "books",
                totalPointsLabel: "Total Points",
                quizCountLabel: "Quizzes Taken",
                streakLabel: "Day Streak",
                question: "Question"
            },
            es: {
                mainTitle: "ğŸ“š Textos del Estudiante de Conocimiento",
                subtitle: "Compilado y Verificado por: Dr. Abdul Muhsin Al-Qasim",
                description: "Cuestionario y Seguimiento de Progreso para Estudiantes",
                tabQuiz: "Examen",
                tabLibrary: "Biblioteca",
                tabProgress: "Progreso",
                tabLeaderboard: "ClasificaciÃ³n",
                welcomeTitle: "Â¡Bienvenido! Â¿QuiÃ©n eres?",
                selectName: "Selecciona tu nombre o agrega uno nuevo:",
                chooseOption: "-- Elegir --",
                addNew: "Agregar nuevo nombre",
                yourName: "Tu nombre:",
                enterName: "Ingresa tu nombre",
                startQuiz: "Iniciar Examen",
                points: "Puntos",
                chooseQuizType: "Elige el Tipo de Examen:",
                bookId: "Identificar el Libro",
                authorId: "Identificar el Autor",
                levelMatch: "Coincidir el Nivel",
                chapterRecall: "Recordar CapÃ­tulos",
                keyPoints: "Puntos Clave",
                random: "Examen Aleatorio",
                endQuiz: "Terminar Examen",
                libraryTitle: "Biblioteca de Textos",
                progressTitle: "Tu Progreso de Estudio",
                leaderboardTitle: "ğŸ† Tabla de ClasificaciÃ³n",
                close: "Cerrar",
                author: "Autor",
                topic: "Tema",
                chaptersTitle: "CapÃ­tulos y Puntos Clave:",
                note: "Nota:",
                noteText: "Puedes agregar mÃ¡s detalles, capÃ­tulos y puntos clave de las explicaciones del Sheikh Abdul Muhsin Al-Qasim",
                excellent: "Â¡Excelente!",
                score: "PuntuaciÃ³n:",
                totalScore: "PuntuaciÃ³n Total:",
                newQuiz: "Nuevo Examen",
                quizCount: "ExÃ¡menes:",
                level1: "Nivel 1",
                level2: "Nivel 2",
                level3: "Nivel 3",
                level4: "Nivel 4",
                level5: "Nivel 5",
                completed: "Completado",
                of: "de",
                booksText: "libros",
                totalPointsLabel: "Puntos Totales",
                quizCountLabel: "ExÃ¡menes Realizados",
                streakLabel: "DÃ­as Consecutivos",
                question: "Pregunta"
            }
        };

        let currentLang = 'ar';

        function changeLanguage(lang) {
            currentLang = lang;
            
            // Update direction
            document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', lang);
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update text content
            const t = translations[lang];
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('description').textContent = t.description;
            
            // Update tabs
            const tabs = document.querySelectorAll('.tab-text');
            tabs[0].textContent = t.tabQuiz;
            tabs[1].textContent = t.tabLibrary;
            tabs[2].textContent = t.tabProgress;
            tabs[3].textContent = t.tabLeaderboard;
            
            // Re-render current view
            renderLibrary();
            renderLeaderboard();
            if (currentUser) renderProgress();
        }

        function t(key) {
            return translations[currentLang][key] || key;
        }

        // Database Structure
        const mutoonDatabase = {
            levels: [
                {
                    id: 1,
                    name: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„",
                    books: [
                        {
                            id: "adhkar",
                            title: "Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø¢Ø¯Ø§Ø¨",
                            author: "Ø¬Ù…Ø¹ ÙˆØªØ±ØªÙŠØ¨: Ø¯. Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ù‚Ø§Ø³Ù…",
                            topic: "Ø§Ù„Ø¢Ø¯Ø§Ø¨ ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø´Ø±Ø¹ÙŠØ©",
                            chapters: [
                                { name: "Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸", points: ["Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸", "Ø§Ù„Ù…Ø³Ø­ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡"] },
                                { name: "Ø¢Ø¯Ø§Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ù„Ø§Ø¡", points: ["Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„", "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬"] },
                                { name: "Ø¢Ø¯Ø§Ø¨ Ø§Ù„ÙˆØ¶ÙˆØ¡", points: ["Ø§Ù„ØªØ³Ù…ÙŠØ©", "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØ¶ÙˆØ¡"] }
                            ]
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ",
                    books: [
                        {
                            id: "usul3",
                            title: "Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ØµÙˆÙ„",
                            author: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ù†Ø¨ÙŠ ÙˆØ§Ù„Ø¯ÙŠÙ†",
                            mustKnow: [
                                "Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø³Ù„Ù… Ù…Ø¹Ø±ÙØªÙ‡Ø§",
                                "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø¨Ø¯ Ø±Ø¨Ù‡: Ø§Ù„Ù„Ù‡ Ø®Ø§Ù„Ù‚ ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØ±Ø§Ø²Ù‚Ù‡ ÙˆÙ…Ø¯Ø¨Ø± Ø£Ù…ÙˆØ±Ù‡",
                                "Ù…Ø¹Ø±ÙØ© Ø¯ÙŠÙ† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø¨Ø§Ù„Ø£Ø¯Ù„Ø©: Ø§Ù„Ø§Ø³ØªØ³Ù„Ø§Ù… Ù„Ù„Ù‡ Ø¨Ø§Ù„ØªÙˆØ­ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ù‚ÙŠØ§Ø¯ Ù„Ù‡ Ø¨Ø§Ù„Ø·Ø§Ø¹Ø©",
                                "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ï·º: Ø§Ø³Ù…Ù‡ ÙˆÙ†Ø³Ø¨Ù‡ ÙˆØ¨Ù„Ø¯Ù‡ ÙˆØ¹Ù…Ø±Ù‡",
                                "Ù…Ø±Ø§ØªØ¨ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø«Ù„Ø§Ø«: Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙˆØ§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆØ§Ù„Ø¥Ø­Ø³Ø§Ù†",
                                "Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø®Ù…Ø³Ø©",
                                "Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† Ø§Ù„Ø³ØªØ©",
                                "Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¥Ø­Ø³Ø§Ù†: Ø£Ù† ØªØ¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ ÙƒØ£Ù†Ùƒ ØªØ±Ø§Ù‡"
                            ],
                            chapters: [
                                { name: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©", points: ["Ø£Ù‡Ù…ÙŠØ© Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…", "Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©"] },
                                { name: "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù„Ù‡", points: ["Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±Ø¨", "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¯ÙŠÙ†", "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù†Ø¨ÙŠ"] }
                            ]
                        },
                        {
                            id: "qawaid4",
                            title: "Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ø±Ø¨Ø¹",
                            author: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ø§Ù„Ø´Ø±Ùƒ ÙˆØ£Ù†ÙˆØ§Ø¹Ù‡",
                            mustKnow: [
                                "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¥Ø®Ù„Ø§Øµ Ù„Ù„Ù‡ ÙˆØ­Ø¯Ù‡ ÙˆØªØ±Ùƒ Ø§Ù„Ø´Ø±Ùƒ",
                                "Ø§Ù„Ù…Ø´Ø±ÙƒÙˆÙ† ÙŠÙ‚Ø±ÙˆÙ† Ø¨ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø±Ø¨ÙˆØ¨ÙŠØ© Ù„ÙƒÙ† Ø£Ø´Ø±ÙƒÙˆØ§ ÙÙŠ Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø©",
                                "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ù„Ù‡ Ø£Ù…Ø± Ø¨Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ ÙÙŠ Ø§Ù„Ø¯ÙŠÙ† ÙˆÙ†Ù‡Ù‰ Ø¹Ù† Ø§Ù„ØªÙØ±Ù‚",
                                "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: ÙˆØ¬ÙˆØ¨ Ø§Ù„Ø³Ù…Ø¹ ÙˆØ§Ù„Ø·Ø§Ø¹Ø© Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆÙ",
                                "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©: Ø§Ù„Ø¹Ù„Ù… Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø¹Ù…Ù„"
                            ],
                            chapters: [
                                { name: "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", points: ["Ø§Ù„Ø¥Ø®Ù„Ø§Øµ Ù„Ù„Ù‡", "Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù…Ø´Ø±ÙƒÙŠÙ†"] },
                                { name: "Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", points: ["Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ†"] }
                            ]
                        },
                        {
                            id: "nawaqid",
                            title: "Ù†ÙˆØ§Ù‚Ø¶ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…",
                            author: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ù†ÙˆØ§Ù‚Ø¶ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…",
                            mustKnow: [
                                "Ø¹Ø¯Ø¯ Ù†ÙˆØ§Ù‚Ø¶ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…: Ø¹Ø´Ø±Ø© Ù†ÙˆØ§Ù‚Ø¶",
                                "Ø§Ù„Ø´Ø±Ùƒ ÙÙŠ Ø¹Ø¨Ø§Ø¯Ø© Ø§Ù„Ù„Ù‡ (Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù…ÙˆØªÙ‰ ÙˆØ§Ù„Ø§Ø³ØªØºØ§Ø«Ø© Ø¨Ù‡Ù…)",
                                "Ù…Ù† Ø¬Ø¹Ù„ Ø¨ÙŠÙ†Ù‡ ÙˆØ¨ÙŠÙ† Ø§Ù„Ù„Ù‡ ÙˆØ³Ø§Ø¦Ø· ÙŠØ¯Ø¹ÙˆÙ‡Ù…",
                                "Ù…Ù† Ù„Ù… ÙŠÙƒÙØ± Ø§Ù„Ù…Ø´Ø±ÙƒÙŠÙ† Ø£Ùˆ Ø´Ùƒ ÙÙŠ ÙƒÙØ±Ù‡Ù…",
                                "Ø§Ù„Ø§Ø³ØªÙ‡Ø²Ø§Ø¡ Ø¨Ø´ÙŠØ¡ Ù…Ù† Ø¯ÙŠÙ† Ø§Ù„Ø±Ø³ÙˆÙ„ ï·º",
                                "Ø¨ØºØ¶ Ø´ÙŠØ¡ Ù…Ù…Ø§ Ø¬Ø§Ø¡ Ø¨Ù‡ Ø§Ù„Ø±Ø³ÙˆÙ„ ï·º",
                                "Ø§Ù„Ø³Ø­Ø± ÙˆÙ…Ù†Ù‡ Ø§Ù„ØµØ±Ù ÙˆØ§Ù„Ø¹Ø·Ù",
                                "Ù…Ø¸Ø§Ù‡Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙƒÙŠÙ† ÙˆÙ…Ø¹Ø§ÙˆÙ†ØªÙ‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ†",
                                "Ù…Ù† Ø§Ø¹ØªÙ‚Ø¯ Ø£Ù† Ù‡Ø¯ÙŠ ØºÙŠØ± Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø£ÙƒÙ…Ù„ Ù…Ù† Ù‡Ø¯ÙŠÙ‡",
                                "Ø§Ù„Ø¥Ø¹Ø±Ø§Ø¶ Ø¹Ù† Ø¯ÙŠÙ† Ø§Ù„Ù„Ù‡ Ù„Ø§ ÙŠØªØ¹Ù„Ù…Ù‡ ÙˆÙ„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ù‡"
                            ],
                            chapters: [
                                { name: "Ø§Ù„Ù†Ø§Ù‚Ø¶ Ø§Ù„Ø£ÙˆÙ„", points: ["Ø§Ù„Ø´Ø±Ùƒ ÙÙŠ Ø¹Ø¨Ø§Ø¯Ø© Ø§Ù„Ù„Ù‡"] },
                                { name: "Ø§Ù„Ù†Ø§Ù‚Ø¶ Ø§Ù„Ø«Ø§Ù†ÙŠ", points: ["Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¨ÙŠÙ† Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ø®Ù„Ù‚"] }
                            ]
                        },
                        {
                            id: "nawawi40",
                            title: "Ø§Ù„Ø£Ø±Ø¨Ø¹ÙˆÙ† Ø§Ù„Ù†ÙˆÙˆÙŠØ©",
                            author: "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ù†ÙˆÙˆÙŠ",
                            topic: "Ø§Ù„Ø­Ø¯ÙŠØ« - Ø£Ø±Ø¨Ø¹ÙˆÙ† Ø­Ø¯ÙŠØ«Ø§Ù‹ Ø¬Ø§Ù…Ø¹Ø§Ù‹",
                            mustKnow: [
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø£ÙˆÙ„: Ø¥Ù†Ù…Ø§ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù†ÙŠØ§Øª",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù†ÙŠ: Ù…Ø±Ø§ØªØ¨ Ø§Ù„Ø¯ÙŠÙ† (Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙˆØ§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆØ§Ù„Ø¥Ø­Ø³Ø§Ù†)",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù„Ø«: Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø®Ù…Ø³Ø©",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø®Ø§Ù…Ø³: Ù…Ù† Ø£Ø­Ø¯Ø« ÙÙŠ Ø£Ù…Ø±Ù†Ø§ Ù‡Ø°Ø§ Ù…Ø§ Ù„ÙŠØ³ Ù…Ù†Ù‡ ÙÙ‡Ùˆ Ø±Ø¯",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¨Ø¹: Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù†ØµÙŠØ­Ø©",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù…Ù†: Ø­Ø±Ù…Ø© Ø¯Ù… Ø§Ù„Ù…Ø³Ù„Ù… ÙˆÙ…Ø§Ù„Ù‡ ÙˆØ¹Ø±Ø¶Ù‡",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø³Ø¹: Ù…Ø§ Ù†Ù‡ÙŠØªÙƒÙ… Ø¹Ù†Ù‡ ÙØ§Ø¬ØªÙ†Ø¨ÙˆÙ‡",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±: Ù…Ù† Ø­Ø³Ù† Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ù…Ø±Ø¡ ØªØ±ÙƒÙ‡ Ù…Ø§ Ù„Ø§ ÙŠØ¹Ù†ÙŠÙ‡",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±: Ù„Ø§ ØªØºØ¶Ø¨",
                                "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù…Ù† ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†: Ø­Ù‚ Ø§Ù„Ù„Ù‡ ÙˆØ­Ù‚ Ø§Ù„Ø¹Ø¨Ø§Ø¯"
                            ],
                            chapters: [
                                { name: "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø£ÙˆÙ„", points: ["Ø¥Ù†Ù…Ø§ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù†ÙŠØ§Øª"] },
                                { name: "Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø«Ø§Ù†ÙŠ", points: ["Ù…Ø±Ø§ØªØ¨ Ø§Ù„Ø¯ÙŠÙ†"] }
                            ]
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«",
                    books: [
                        {
                            id: "tuhfa",
                            title: "ØªØ­ÙØ© Ø§Ù„Ø£Ø·ÙØ§Ù„",
                            author: "Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø¬Ù…Ø²ÙˆØ±ÙŠ",
                            topic: "Ø§Ù„ØªØ¬ÙˆÙŠØ¯ - Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØªØ¬ÙˆÙŠØ¯",
                            chapters: [
                                { name: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©", points: ["Ø£Ù‡Ù…ÙŠØ© Ø§Ù„ØªØ¬ÙˆÙŠØ¯", "Ù…Ø±Ø§ØªØ¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©"] },
                                { name: "Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù†ÙˆÙ† Ø§Ù„Ø³Ø§ÙƒÙ†Ø©", points: ["Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø±", "Ø§Ù„Ø¥Ø¯ØºØ§Ù…", "Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¨", "Ø§Ù„Ø¥Ø®ÙØ§Ø¡"] }
                            ]
                        },
                        {
                            id: "shurut",
                            title: "Ø´Ø±ÙˆØ· Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ£Ø±ÙƒØ§Ù†Ù‡Ø§ ÙˆÙˆØ§Ø¬Ø¨Ø§ØªÙ‡Ø§",
                            author: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
                            topic: "Ø§Ù„ÙÙ‚Ù‡ - Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙ„Ø§Ø©",
                            chapters: [
                                { name: "Ø§Ù„Ø´Ø±ÙˆØ·", points: ["Ø§Ù„Ø¥Ø³Ù„Ø§Ù…", "Ø§Ù„Ø¹Ù‚Ù„", "Ø§Ù„ØªÙ…ÙŠÙŠØ²"] },
                                { name: "Ø§Ù„Ø£Ø±ÙƒØ§Ù†", points: ["Ø§Ù„Ù‚ÙŠØ§Ù…", "ØªÙƒØ¨ÙŠØ±Ø© Ø§Ù„Ø¥Ø­Ø±Ø§Ù…", "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙØ§ØªØ­Ø©"] }
                            ]
                        },
                        {
                            id: "tawheed",
                            title: "ÙƒØªØ§Ø¨ Ø§Ù„ØªÙˆØ­ÙŠØ¯",
                            author: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ø§Ù„ØªÙˆØ­ÙŠØ¯ ÙˆØ£Ù†ÙˆØ§Ø¹Ù‡",
                            mustKnow: [
                                "Ø§Ù„ØªÙˆØ­ÙŠØ¯: Ø¥ÙØ±Ø§Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø©",
                                "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø«Ù„Ø§Ø«Ø©: Ø§Ù„Ø±Ø¨ÙˆØ¨ÙŠØ© ÙˆØ§Ù„Ø£Ù„ÙˆÙ‡ÙŠØ© ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„ØµÙØ§Øª",
                                "ÙØ¶Ù„ Ø§Ù„ØªÙˆØ­ÙŠØ¯: ÙŠÙ…Ø­Ùˆ Ø§Ù„Ø°Ù†ÙˆØ¨ ÙˆÙŠÙˆØ¬Ø¨ Ø§Ù„Ø¬Ù†Ø©",
                                "Ø§Ù„Ø®ÙˆÙ Ù…Ù† Ø§Ù„Ø´Ø±Ùƒ: Ø£Ø®ÙˆÙ Ù…Ø§ ÙŠØ®Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø©",
                                "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø¹Ø¨Ø§Ø¯Ø© ÙˆÙ„Ø§ ÙŠØ¬ÙˆØ² ØµØ±ÙÙ‡ Ù„ØºÙŠØ± Ø§Ù„Ù„Ù‡",
                                "Ø§Ù„Ø°Ø¨Ø­ ÙˆØ§Ù„Ù†Ø°Ø± Ø¹Ø¨Ø§Ø¯Ø© Ù„Ø§ ØªÙƒÙˆÙ† Ø¥Ù„Ø§ Ù„Ù„Ù‡",
                                "Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø°Ø© ÙˆØ§Ù„Ø§Ø³ØªØºØ§Ø«Ø© Ø¨ØºÙŠØ± Ø§Ù„Ù„Ù‡ Ø´Ø±Ùƒ",
                                "Ø§Ù„ØªÙˆØ³Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„Ù…Ù…Ù†ÙˆØ¹",
                                "Ø§Ù„Ø´ÙØ§Ø¹Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© ÙˆØ§Ù„Ù…Ù†ÙÙŠØ©",
                                "ØªØ­Ø±ÙŠÙ… Ø§Ù„Ø³Ø­Ø± ÙˆØ§Ù„ÙƒÙ‡Ø§Ù†Ø© ÙˆØ§Ù„ØªÙ†Ø¬ÙŠÙ…"
                            ],
                            chapters: [
                                { name: "ÙØ¶Ù„ Ø§Ù„ØªÙˆØ­ÙŠØ¯", points: ["Ù…Ø¹Ù†Ù‰ Ø§Ù„ØªÙˆØ­ÙŠØ¯", "ÙØ¶Ù„ Ø§Ù„ØªÙˆØ­ÙŠØ¯"] },
                                { name: "Ø§Ù„Ø®ÙˆÙ Ù…Ù† Ø§Ù„Ø´Ø±Ùƒ", points: ["Ø®Ø·ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ùƒ", "Ø§Ù„Ø­Ø°Ø± Ù…Ù† Ø§Ù„Ø´Ø±Ùƒ"] }
                            ]
                        }
                    ]
                },
                {
                    id: 4,
                    name: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹",
                    books: [
                        {
                            id: "bayquniyya",
                            title: "Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø¨ÙŠÙ‚ÙˆÙ†ÙŠØ©",
                            author: "Ø¹Ù…Ø± Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨ÙŠÙ‚ÙˆÙ†ÙŠ",
                            topic: "Ù…ØµØ·Ù„Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«",
                            chapters: [
                                { name: "Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«", points: ["Ø§Ù„ØµØ­ÙŠØ­", "Ø§Ù„Ø­Ø³Ù†", "Ø§Ù„Ø¶Ø¹ÙŠÙ"] },
                                { name: "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø¯ÙŠØ«", points: ["Ø§Ù„Ù…ØªÙˆØ§ØªØ±", "Ø§Ù„Ø¢Ø­Ø§Ø¯"] }
                            ]
                        },
                        {
                            id: "ilbiri",
                            title: "Ù‚ØµÙŠØ¯Ø© Ø§Ù„Ø¥Ù„Ø¨ÙŠØ±ÙŠ",
                            author: "Ø£Ø¨Ùˆ Ø¥Ø³Ø­Ø§Ù‚ Ø§Ù„Ø¥Ù„Ø¨ÙŠØ±ÙŠ",
                            topic: "Ø§Ù„Ø²Ù‡Ø¯ ÙˆØ§Ù„Ø­Ø« Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…",
                            chapters: [
                                { name: "Ø§Ù„Ø­Ø« Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…", points: ["ÙØ¶Ù„ Ø§Ù„Ø¹Ù„Ù…", "Ø¢Ø¯Ø§Ø¨ Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…"] }
                            ]
                        },
                        {
                            id: "ajrumiyya",
                            title: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ø¢Ø¬Ø±ÙˆÙ…ÙŠØ©",
                            author: "Ø§Ø¨Ù† Ø¢Ø¬Ø±ÙˆÙ…",
                            topic: "Ø§Ù„Ù†Ø­Ùˆ - Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                            chapters: [
                                { name: "Ø§Ù„ÙƒÙ„Ø§Ù…", points: ["ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ù…", "Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ø§Ù…"] },
                                { name: "Ø§Ù„Ø¥Ø¹Ø±Ø§Ø¨", points: ["Ø§Ù„Ø±ÙØ¹", "Ø§Ù„Ù†ØµØ¨", "Ø§Ù„Ø¬Ø±", "Ø§Ù„Ø¬Ø²Ù…"] }
                            ]
                        },
                        {
                            id: "wasitiyya",
                            title: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© Ø§Ù„ÙˆØ§Ø³Ø·ÙŠØ©",
                            author: "Ø§Ø¨Ù† ØªÙŠÙ…ÙŠØ©",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ø¹Ù‚ÙŠØ¯Ø© Ø£Ù‡Ù„ Ø§Ù„Ø³Ù†Ø©",
                            chapters: [
                                { name: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©", points: ["Ù…Ù†Ù‡Ø¬ Ø£Ù‡Ù„ Ø§Ù„Ø³Ù†Ø©"] },
                                { name: "Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† Ø¨Ø§Ù„Ù„Ù‡", points: ["ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„ØµÙØ§Øª"] }
                            ]
                        }
                    ]
                },
                {
                    id: 5,
                    name: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³",
                    books: [
                        {
                            id: "waraqat",
                            title: "Ø§Ù„ÙˆØ±Ù‚Ø§Øª",
                            author: "Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø±Ù…ÙŠÙ† Ø§Ù„Ø¬ÙˆÙŠÙ†ÙŠ",
                            topic: "Ø£ØµÙˆÙ„ Ø§Ù„ÙÙ‚Ù‡",
                            chapters: [
                                { name: "ØªØ¹Ø±ÙŠÙ Ø£ØµÙˆÙ„ Ø§Ù„ÙÙ‚Ù‡", points: ["Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø£ØµÙˆÙ„", "Ù…Ø¹Ù†Ù‰ Ø§Ù„ÙÙ‚Ù‡"] },
                                { name: "Ø§Ù„Ø£Ø­ÙƒØ§Ù…", points: ["Ø§Ù„ÙˆØ§Ø¬Ø¨", "Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨", "Ø§Ù„Ù…Ø¨Ø§Ø­"] }
                            ]
                        },
                        {
                            id: "unwanhukm",
                            title: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ÙƒÙ…",
                            author: "Ø£Ø¨Ùˆ Ø§Ù„Ù†Ø¬Ø§ Ø§Ù„Ø­Ø¬Ø§ÙˆÙŠ",
                            topic: "Ø§Ù„ÙÙ‚Ù‡ - Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù‚Ø¶Ø§Ø¡",
                            chapters: [
                                { name: "Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ù‚Ø§Ø¶ÙŠ", points: ["Ø§Ù„Ø¹Ø¯Ù„", "Ø§Ù„Ø¹Ù„Ù…"] }
                            ]
                        },
                        {
                            id: "rahbiyya",
                            title: "Ø§Ù„Ø±Ø­Ø¨ÙŠØ©",
                            author: "Ø§Ù„Ø±Ø­Ø¨ÙŠ",
                            topic: "Ø§Ù„ÙØ±Ø§Ø¦Ø¶ - Ø¹Ù„Ù… Ø§Ù„Ù…ÙˆØ§Ø±ÙŠØ«",
                            chapters: [
                                { name: "Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶", points: ["Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ù†ØµÙ", "Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø¹"] }
                            ]
                        },
                        {
                            id: "tahawiyya",
                            title: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© Ø§Ù„Ø·Ø­Ø§ÙˆÙŠØ©",
                            author: "Ø£Ø¨Ùˆ Ø¬Ø¹ÙØ± Ø§Ù„Ø·Ø­Ø§ÙˆÙŠ",
                            topic: "Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© - Ø¹Ù‚ÙŠØ¯Ø© Ø§Ù„Ø³Ù„Ù",
                            chapters: [
                                { name: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©", points: ["Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø³Ù„Ù Ø§Ù„ØµØ§Ù„Ø­"] },
                                { name: "Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†", points: ["ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†", "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆÙ†Ù‚ØµØ§Ù†Ù‡"] }
                            ]
                        }
                    ]
                }
            ]
        };

        // User Management
        let users = JSON.parse(localStorage.getItem('mutoonUsers')) || [];
        let currentUser = null;
        let currentScore = 0;
        let currentQuestions = [];
        let currentQuestionIndex = 0;

        // Initialize
        function init() {
            loadUsers();
            renderLibrary();
            renderLeaderboard();
            renderStudyMode();
        }

        function loadUsers() {
            const select = document.getElementById('userSelect');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.name;
                option.textContent = user.name;
                select.appendChild(option);
            });
            select.innerHTML += '<option value="new">Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯</option>';
        }

        function handleUserSelect() {
            const select = document.getElementById('userSelect');
            const newUserInput = document.getElementById('newUserInput');
            if (select.value === 'new') {
                newUserInput.style.display = 'block';
            } else {
                newUserInput.style.display = 'none';
            }
        }

        function startQuiz() {
            const select = document.getElementById('userSelect');
            const newUserName = document.getElementById('newUserName').value;
            
            let userName = select.value === 'new' ? newUserName.trim() : select.value;
            
            if (!userName) {
                alert(t('enterName'));
                return;
            }
            
            let user = users.find(u => u.name === userName);
            if (!user) {
                user = {
                    name: userName,
                    totalScore: 0,
                    quizzesTaken: 0,
                    lastActive: new Date().toISOString(),
                    streak: 1,
                    booksCompleted: []
                };
                users.push(user);
                saveUsers();
            }
            
            currentUser = user;
            currentScore = 0;
            document.getElementById('userSetup').style.display = 'none';
            document.getElementById('quizInterface').style.display = 'block';
            document.getElementById('currentUserName').textContent = userName;
            document.getElementById('currentScore').textContent = '0';
            
            // Update quiz interface
            updateQuizInterface();
        }

        function updateQuizInterface() {
            const html = `
                <div class="score-display">
                    <span id="currentUserName">${currentUser.name}</span> | ${t('points')}: <span id="currentScore">0</span>
                </div>
                
                <div class="quiz-section">
                    <h2>${t('chooseQuizType')}</h2>
                    <div class="quiz-options">
                        <button class="quiz-btn" onclick="startQuizMode('bookId')">${t('bookId')}</button>
                        <button class="quiz-btn" onclick="startQuizMode('authorId')">${t('authorId')}</button>
                        <button class="quiz-btn" onclick="startQuizMode('levelMatch')">${t('levelMatch')}</button>
                        <button class="quiz-btn" onclick="startQuizMode('chapterRecall')">${t('chapterRecall')}</button>
                        <button class="quiz-btn" onclick="startQuizMode('keyPoints')">${t('keyPoints')}</button>
                        <button class="quiz-btn" onclick="startQuizMode('random')">${t('random')}</button>
                    </div>
                </div>
                
                <div id="questionArea"></div>
                
                <button class="btn-secondary" onclick="endQuiz()">${t('endQuiz')}</button>
            `;
            document.getElementById('quizInterface').innerHTML = html;
        }

        function renderStudyMode() {
            const studyContent = document.getElementById('studyContent');
            let html = '';
            
            mutoonDatabase.levels.forEach(level => {
                const levelName = t(`level${level.id}`);
                html += `<h3 style="color: #667eea; margin: 25px 0 15px 0; font-size: 1.4em;">${levelName}</h3>`;
                
                level.books.forEach(book => {
                    if (!book.mustKnow) return; // Skip books without must-know points
                    
                    html += `
                        <div class="study-card">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h3 style="color: #333; margin-bottom: 5px;">${book.title}</h3>
                                    <p style="color: #666; font-size: 0.9em;">${book.author}</p>
                                </div>
                                <span class="level-badge">${levelName}</span>
                            </div>
                            
                            <div class="must-know-section">
                                <div class="must-know-title">
                                    â­ ${currentLang === 'ar' ? 'Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø­ÙØ¸Ù‡Ø§' : currentLang === 'en' ? 'Essential Points to Memorize' : 'Puntos Esenciales para Memorizar'}
                                </div>
                                ${book.mustKnow.map((point, index) => `
                                    <div class="must-know-item">
                                        <strong>${index + 1}.</strong> ${point}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <button class="test-this-btn" onclick="startBookQuiz('${book.id}')">
                                ${currentLang === 'ar' ? 'âœ“ Ø§Ø®ØªØ¨Ø±Ù†ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨' : currentLang === 'en' ? 'âœ“ Test Me on This Book' : 'âœ“ ExamÃ­name sobre Este Libro'}
                            </button>
                        </div>
                    `;
                });
            });
            
            studyContent.innerHTML = html;
        }

        function startBookQuiz(bookId) {
            // Switch to quiz tab
            showTab('quiz');
            
            // Auto-start user if already logged in
            if (!currentUser) {
                alert(currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹' : currentLang === 'en' ? 'Please enter your name first' : 'Por favor ingresa tu nombre primero');
                return;
            }
            
            // Generate questions specifically for this book
            const book = mutoonDatabase.levels
                .flatMap(l => l.books)
                .find(b => b.id === bookId);
                
            if (!book) return;
            
            currentQuestions = generateBookQuestions(book, 10);
            currentQuestionIndex = 0;
            currentScore = 0;
            document.getElementById('currentScore').textContent = '0';
            showQuestion();
        }

        function generateBookQuestions(book, count) {
            const questions = [];
            
            for (let i = 0; i < count && i < book.mustKnow.length; i++) {
                const correctPoint = book.mustKnow[i];
                const wrongPoints = book.mustKnow.filter((p, idx) => idx !== i).slice(0, 3);
                
                questions.push({
                    text: currentLang === 'ar' 
                        ? `Ù…Ù† ÙƒØªØ§Ø¨ "${book.title}"ØŒ Ø£ÙŠ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ§Ù„ÙŠØ© ØµØ­ÙŠØ­Ø©ØŸ`
                        : currentLang === 'en'
                        ? `From the book "${book.title}", which of the following points is correct?`
                        : `Del libro "${book.title}", Â¿cuÃ¡l de los siguientes puntos es correcto?`,
                    options: shuffle([correctPoint, ...wrongPoints]),
                    correct: correctPoint,
                    type: 'mustKnow'
                });
            }
            
            return questions;
        }

        function startQuizMode(mode) {
            currentQuestions = generateQuestions(mode, 5);
            currentQuestionIndex = 0;
            showQuestion();
        }

        function generateQuestions(mode, count) {
            const questions = [];
            const allBooks = mutoonDatabase.levels.flatMap(l => l.books.map(b => ({...b, level: l.name})));
            
            for (let i = 0; i < count; i++) {
                const book = allBooks[Math.floor(Math.random() * allBooks.length)];
                let question;
                
                switch(mode) {
                    case 'bookId':
                        const wrongBooks = allBooks.filter(b => b.id !== book.id);
                        const options = [book.title];
                        for (let j = 0; j < 3; j++) {
                            const wrong = wrongBooks[Math.floor(Math.random() * wrongBooks.length)];
                            if (!options.includes(wrong.title)) options.push(wrong.title);
                        }
                        question = {
                            text: `Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù ÙƒØªØ§Ø¨: ${book.title}ØŸ`,
                            options: shuffle([book.author, ...allBooks.filter(b => b.author !== book.author).slice(0,3).map(b => b.author)]),
                            correct: book.author,
                            type: 'authorId'
                        };
                        break;
                        
                    case 'authorId':
                        question = {
                            text: `Ù…Ø§ Ù‡Ùˆ Ù…ÙˆØ¶ÙˆØ¹ ÙƒØªØ§Ø¨: ${book.title}ØŸ`,
                            options: shuffle([book.topic, ...allBooks.filter(b => b.topic !== book.topic).slice(0,3).map(b => b.topic)]),
                            correct: book.topic,
                            type: 'topic'
                        };
                        break;
                        
                    case 'levelMatch':
                        question = {
                            text: `ÙÙŠ Ø£ÙŠ Ù…Ø³ØªÙˆÙ‰ ÙŠÙ‚Ø¹ ÙƒØªØ§Ø¨: ${book.title}ØŸ`,
                            options: shuffle([book.level, ...mutoonDatabase.levels.filter(l => l.name !== book.level).slice(0,3).map(l => l.name)]),
                            correct: book.level,
                            type: 'level'
                        };
                        break;
                        
                    case 'chapterRecall':
                        if (book.chapters && book.chapters.length > 0) {
                            const chapter = book.chapters[Math.floor(Math.random() * book.chapters.length)];
                            question = {
                                text: `Ù…Ù† ÙƒØªØ§Ø¨ ${book.title}ØŒ Ù…Ø§ Ù‡Ùˆ Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ø§Ø¨: ${chapter.name}ØŸ`,
                                options: shuffle(chapter.points.concat(
                                    book.chapters.filter(c => c !== chapter)
                                        .flatMap(c => c.points)
                                        .slice(0, 3)
                                )),
                                correct: chapter.points[0],
                                type: 'chapter'
                            };
                        }
                        break;
                        
                    case 'random':
                        const modes = ['bookId', 'authorId', 'levelMatch'];
                        return generateQuestions(modes[Math.floor(Math.random() * modes.length)], 1)[0];
                }
                
                if (question) questions.push(question);
            }
            
            return questions;
        }

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                finishQuiz();
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            const html = `
                <div class="question-card">
                    <div class="question-text">${t('question')} ${currentQuestionIndex + 1} ${t('of')} ${currentQuestions.length}</div>
                    <div class="question-text">${question.text}</div>
                    <div class="options">
                        ${question.options.map(opt => `
                            <button class="option-btn" onclick="checkAnswer('${opt.replace(/'/g, "\\'")}', '${question.correct.replace(/'/g, "\\'")}')">${opt}</button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('questionArea').innerHTML = html;
        }

        function checkAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correct) {
                    btn.classList.add('correct');
                }
                if (btn.textContent === selected && selected !== correct) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selected === correct) {
                currentScore += 10;
                document.getElementById('currentScore').textContent = currentScore;
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 1500);
        }

        function finishQuiz() {
            currentUser.totalScore += currentScore;
            currentUser.quizzesTaken++;
            currentUser.lastActive = new Date().toISOString();
            saveUsers();
            
            const html = `
                <div class="question-card" style="text-align: center;">
                    <h2>ğŸ‰ ${t('excellent')}</h2>
                    <div class="score-display">${t('score')} ${currentScore} ${t('points')}</div>
                    <p>${t('totalScore')} ${currentUser.totalScore}</p>
                    <button class="btn-primary" onclick="location.reload()">${t('newQuiz')}</button>
                </div>
            `;
            document.getElementById('questionArea').innerHTML = html;
            renderLeaderboard();
        }

        function endQuiz() {
            if (confirm(currentLang === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ' : currentLang === 'en' ? 'Do you want to end the quiz?' : 'Â¿Quieres terminar el examen?')) {
                location.reload();
            }
        }

        function saveUsers() {
            localStorage.setItem('mutoonUsers', JSON.stringify(users));
        }

        function renderLibrary() {
            const grid = document.getElementById('libraryGrid');
            let html = '';
            
            mutoonDatabase.levels.forEach(level => {
                const levelName = t(`level${level.id}`);
                level.books.forEach(book => {
                    html += `
                        <div class="book-card" onclick="showBookDetails('${book.id}')">
                            <span class="level-badge">${levelName}</span>
                            <div class="book-title">${book.title}</div>
                            <div class="book-author">${book.author}</div>
                            <div style="margin-top: 10px; color: #666; font-size: 0.9em;">${book.topic}</div>
                        </div>
                    `;
                });
            });
            
            grid.innerHTML = html;
        }

        function showBookDetails(bookId) {
            const book = mutoonDatabase.levels
                .flatMap(l => l.books)
                .find(b => b.id === bookId);
            
            if (!book) return;
            
            let html = `
                <h2>${book.title}</h2>
                <p><strong>${t('author')}:</strong> ${book.author}</p>
                <p><strong>${t('topic')}:</strong> ${book.topic}</p>
                <h3 style="margin-top: 20px;">${t('chaptersTitle')}</h3>
                <ul class="chapter-list">
            `;
            
            if (book.chapters) {
                book.chapters.forEach(chapter => {
                    html += `
                        <li class="chapter-item">
                            <strong>${chapter.name}</strong>
                            ${chapter.points.map(p => `<div class="key-point">â€¢ ${p}</div>`).join('')}
                        </li>
                    `;
                });
            }
            
            html += `</ul>
                <p style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                    ğŸ’¡ <strong>${t('note')}</strong> ${t('noteText')}
                </p>
            `;
            
            document.getElementById('bookDetails').innerHTML = html;
            document.getElementById('bookModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('bookModal').classList.remove('active');
        }

        function renderLeaderboard() {
            const sorted = [...users].sort((a, b) => b.totalScore - a.totalScore);
            let html = '';
            
            sorted.forEach((user, index) => {
                const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : '';
                html += `
                    <div class="leaderboard-item">
                        <div class="rank">${medal} #${index + 1}</div>
                        <div class="name">${user.name}</div>
                        <div class="stats">
                            <div>${t('points')}: ${user.totalScore}</div>
                            <div>${t('quizCount')} ${user.quizzesTaken}</div>
                            ${user.streak > 1 ? `<div class="streak-badge">ğŸ”¥ ${user.streak} ${currentLang === 'ar' ? 'ÙŠÙˆÙ…' : currentLang === 'en' ? 'days' : 'dÃ­as'}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            const noUsersMsg = currentLang === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¨Ø¹Ø¯' : currentLang === 'en' ? 'No users yet' : 'AÃºn no hay usuarios';
            document.getElementById('leaderboardContent').innerHTML = html || `<p style="text-align:center;">${noUsersMsg}</p>`;
        }

        function renderProgress() {
            if (!currentUser) {
                const msg = currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹' : currentLang === 'en' ? 'Please start the quiz first' : 'Por favor, comienza el examen primero';
                document.getElementById('progressContent').innerHTML = `<p>${msg}</p>`;
                return;
            }
            
            const totalBooks = mutoonDatabase.levels.reduce((sum, l) => sum + l.books.length, 0);
            const completed = currentUser.booksCompleted?.length || 0;
            const percentage = (completed / totalBooks * 100).toFixed(0);
            
            let html = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%"></div>
                </div>
                <p style="text-align: center; font-size: 1.2em; margin: 20px 0;">
                    ${t('completed')} ${completed} ${t('of')} ${totalBooks} ${t('booksText')} (${percentage}%)
                </p>
                <div class="stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #667eea;">${currentUser.totalScore}</div>
                        <div>${t('totalPointsLabel')}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #667eea;">${currentUser.quizzesTaken}</div>
                        <div>${t('quizCountLabel')}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #667eea;">${currentUser.streak || 1}</div>
                        <div>${t('streakLabel')} ğŸ”¥</div>
                    </div>
                </div>
            `;
            
            document.getElementById('progressContent').innerHTML = html;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'progress') {
                renderProgress();
            }
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
